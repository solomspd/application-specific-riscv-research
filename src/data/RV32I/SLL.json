{
	"modules": [
		{
			"module": "pc",
			"input": [
				{
					"name": "clk", "length": 1, "module": "datapath", "port": "clk"
				},
				{
					"name": "rst", "length": 1, "module": "datapath", "port": "rst"
				},
				{
					"name": "in", "length": 32, "module": "pc", "port": "pc_out", "modifier": "%c+4"
				}
			],
			"output": [
				{
					"name": "pc_out", "length": 32
				}
			],
			"code": [
				{
					"type": "always", "trigger": "posedge rst",
					"code": [
						{
							"type": "loose",
							"code": "out = 0;"
						}
					]
				},
				{
					"type": "always", "trigger": "posedge clk",
					"code": [
						{
							"type": "loose",
							"code": "out <= ~rst ? in : 0"
						}
					]
				}
			]
		},
		{
			"module": "inst_mem",
			"input": [
				{
					"name": "addr", "length": 32, "module": "pc", "port": "pc_out", "modifier": null
				}
			],
			"output": [
				{
					"name": "inst", "length": 32
				}
			],
			"code": [
				{
					"type": "loose",
					"code": "
					reg [7:0] mem [1023:0];
					assign inst = {mem[addr+3], mem[addr+2], mem[addr+1], mem[addr]};
					"
				}
			]
		},
		{
			"module": "control_unit",
			"input": [
				{
					"name": "op", "length": 5, "module": "inst_mem", "port": "inst", "modifier": "%c[`IR_opcode]"
				}
			],
			"output": [
				{
					"name": "reg_write", "length": 1
				},
				{
					"name": "alu_op", "length": 2
				}
			],
			"code": [
				{
					"type": "always", "trigger": "*",
					"code": [
						{
							"type": "case", "selector": "op",
							"code": [
								{
									"type": "loose",
									"code": "
									`OPCODE_Arith_R: begin
									branch = 1'b0;
									mem_read = 1'b0;
									mem_to_reg = 1'b0;
									mem_write = 1'b0;
									alu_src = 1'b0;
									reg_write = 1'b1;
									alu_op = 2'b10;
									end
									"
								}
							]
						}
					]
				}
			]
		},
		{
			"module": "reg_file",
			"input": [
				{
					"name": "clk", "length": 1, "module": "datapath", "port": "clk", "modifier": null
				},
				{
					"name": "rst", "length": 1, "module": "datapath", "port": "rst", "modifier": null
				},
				{
					"name": "src1", "length": 5, "module": "inst_mem", "port": "inst", "modifier": "%c[`IR_rs1]"
				},
				{
					"name": "src2", "length": 5, "module": "inst_mem", "port": "inst", "modifier": "%c[`IR_rs2]"
				},
				{
					"name": "reg_write", "length": 1, "module": "control_unit", "port": "reg_write", "modifier": null
				},
				{
					"name": "write_data", "length": 32, "module": "alu", "port": "alu_out", "modifier": null
				}
			],
			"output": [
				{
					"name": "rs1", "length": 32 
				},
				{
					"name": "rs2", "length": 32
				}
			],
			"code": [
				{
					"type": "always", "trigger": "posedge clk",
					"code": [
						{
							"type": "loose",
							"code": "
							reg [31:0]mem[31:0];

							always @(posedge clk) begin
								if (reg_write && dest != 5'b0) begin
									mem[dest] = dest ? write_data : 0;
								end
							end
						
							assign read1 = dest ? mem[src1] : 0;
							assign read2 = dest ? mem[src2] : 0;
							"
						}
					]
				}
			]
		},
		{
			"module": "alu_ctrl",
			"input": [
				{
					"name": "alu_op", "length": 2, "module": "control_unit", "port": "alu_op", "modifier": null
				},
				{
					"name": "func7", "length": 7, "module": "inst_mem", "port": "inst", "modifier": "%c[`IR_funct7]"
				},
				{
					"name": "func3", "length": 3, "module": "inst_mem", "port": "inst", "modifier": "%c[`IR_funct3]"
				}
			],
			"output": [
				{
					"name": "alu_out", "length": 4
				}
			],
			"code": [
				{
					"type": "always", "trigger": "*",
					"code": [
						{
							"type": "case", "selector": "alu_op",
							"code": [
								{
									"type": "case", "selector": "func3",
									"code": [
										{
											"type": "loose",
											"code": "`F3_SLL: `ALU_SLL"
										}
									]
									
								},
								{
									"type": "loose",
									"code": "2'b11: "
								},
								{
									"type": "case", "selector": "func3",
									"code": [
										{
											"type": "loose",
											"code": "`F3_SLL: out = `ALU_SLL"
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"module": "alu",
			"input": [
				{
					"name": "a", "length": 32, "module": "reg_file", "port": "rs1", "modifier": null
				},
				{
					"name": "b", "length": 32, "module": "reg_file", "input": "rs2", "modifier": null
				},
				{
					"name": "alufn", "length": 4, "module": "alu_ctrl", "port": "alu_out", "modifier": null
				}
			],
			"output": [
				{
					"name": "alu_out", "length": 32
				}
			],
			"code": [
				{
					"type": "always", "trigger": "*",
					"code": [
						{
							"type": "case", "selector": "alufn",
							"code": [
								{
									"type": "loose",
									"code": "
									`ALU_SLL : out = a << b;
									"
								}
							]
						}
					]
				}
			]
		}
	]
}